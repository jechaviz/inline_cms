(function(U){var ao=U("<div>").css({display:"none"}).appendTo("body"),S=U("<div>").css({display:"none"}).appendTo("body"),n=U("<div>").appendTo(S),Y=U("<div>").appendTo(n),G=U("<div>").appendTo(Y),v=U("<div>").appendTo(G),B=U("<div>").appendTo(n),O=U("<div>").appendTo(B),Z=U("<div>").appendTo(O),p=U("<img>").appendTo(n),z=U("<img>").appendTo(n),ag=U("<img>").appendTo(n),b=U("<div>").appendTo(S);var P={},ah=null,an=null,aq=0,D=false;function al(){var d=an+1;if(d>=ah.length){d=0}return d}function o(){var d=an-1;if(d<0){d=ah.length-1}return d}function f(){if(aq===ah.length-1){return aj()}else{++aq;return M(al())}}function Q(){if(aq===1-ah.length){return aj()}else{--aq;return M(o())}}function H(d){if(P.keyNext.indexOf(d.which)!==-1){f();return false}else{if(P.keyPrev.indexOf(d.which)!==-1){Q();return false}else{if(P.keyClose.indexOf(d.which)!==-1){aj();return false}}}}function V(i,d){var k=i.removeAttr("src").clone(true).attr("src",d);i.replaceWith(k);return k}function M(k,d){if("number"===typeof k){if(k===an||k<0||k>ah.length-1){return}an=k;var t=U(ah[an]);k=t.data("href")||t.attr("href")}else{if("number"!==typeof d){d=-1}if(an===d){return}an=d}D=true;p=V(p,k);R();var s=U(ah[al()]);z=V(z,s.data("href")||s.attr("href"));var i=U(ah[o()]);ag=V(ag,i.data("href")||i.attr("href"));ao.fadeIn(P.fadeIn);S.fadeIn(P.fadeIn);P.onopen.call(ah,ah[an],an);U(document).unbind("keydown",H).bind("keydown",H);return false}function aj(){if(!D){return}D=false;an=null;aq=0;ao.fadeOut(P.fadeOut);S.fadeOut(P.fadeOut,K);P.onclose.call(ah);U(document).unbind("keydown",H);return false}function I(){ah.unbind("click.abigimage")}Y.click(function(){return Q()});B.click(function(){return aj()});var h=function(d){d.preventDefault()};S.on("touchmove",h).on("wheel",h);var r,q,w,af,ad,ai,am,l,g,L,X,N,a,e,at,C,av,ae,A=false,ab=[null,null,null],ak=n[0].style;au();R();function R(){p[0].addEventListener("touchstart",ar);p[0].addEventListener("touchmove",E);p[0].addEventListener("touchend",aa);p[0].addEventListener("touchcancel",aa)}function au(){af=0;ad=0;ai=1;C=null;ae=false;if(P.imgCSS){p.css({zIndex:P.imgCSS.zIndex})}}function F(k,x){var s=0;for(var i=0,d=k.length;i<d;i++){s+=k[i]["page"+x]}return s/d}function ap(d){return Math.sqrt(Math.pow(d.touches[0].pageX-d.touches[1].pageX,2)+Math.pow(d.touches[0].pageY-d.touches[1].pageY,2))}function ar(d){if(!D){return}if(d.touches.length>1){ae=true;am=ap(d);p.css({zIndex:P.prevBtnBoxCSS.zIndex})}else{C=null;N=(new Date()).getTime();a=n.width()*0.34;e=n.height();at=P.slideWidth*a;L=p.width();X=p.height()}r=af;q=ad;w=ai;l=0;g=0;av=d.touches;d.preventDefault()}function E(k){if(!D){return}l=(F(k.touches,"X")-F(av,"X"));g=(F(k.touches,"Y")-F(av,"Y"));af=r+l/ai;ad=q+g/ai;if(k.touches.length>1){ai=Math.max(1,w*(ap(k)/am))}if(ai>P.zoomMin){var s=0.5*(L-(L/ai));var i=0.5*(X-(X/ai));af=Math.max(-s,Math.min(s,af));ad=Math.max(-i,Math.min(i,ad))}else{if(null===C){var d=Math.abs(g)-Math.abs(l);if(Math.abs(d)>2){C=d>0}}if(C){af=0}else{ad=0}}W(af,ad,ai,false);k.preventDefault()}function aa(i){if(!D){return}var d=(new Date()).getTime()-N;if(!i.touches.length){if(ai<=P.zoomMin){if(d<=1||(l>=-1&&l<=1&&g>=-1&&g<=1)){if(ae){u(0,0,1)}else{T(true)}}else{if(C){var k=Math.abs(g);if(k>at){c()}else{if(k/d>P.slideVelocity){c()}else{j()}}}else{if(l<-at){T()}else{if(l>at){m()}else{if(Math.abs(l)/d>P.slideVelocity){if(l<0){T()}else{m()}}else{j()}}}}}au()}else{if(ai>P.zoomMax){ai=P.zoomMax;W(af,ad,ai,true)}}}if(ai<=P.zoomMin){p.css({zIndex:P.imgCSS.zIndex})}av=i.touches;i.preventDefault()}n.on("transitionend webkitTransitionEnd msTransitionEnd oTransitionEnd",K);function K(){A=false;for(var d=0;d<2;d++){if(ab[d]){ab[d]();ab[d]=null;if(A){break}}}}p.click(function(){return f()});function T(d){W(d?0:-a,0,1,!d);ac(f)}function m(){W(a,0,1,true);ac(Q)}function j(){W(0,0,1,true)}function c(){j();ac();aj()}function J(k,d){if(A){ab[d||0]=k}else{k()}}function W(d,ax,t,aw,k){J(function(){u(d,ax,t,aw)},k)}function ac(d){J(function(){u(0,0,1,false);if(d){d()}},1)}function u(d,aw,k,t){A=t;var i="scale("+k+") translate3d("+d+"px, "+aw+"px, 0)";ak.transition=t?"all .2s ease-out":"";ak.webkitTransform=i;ak.mozTransform=i;ak.msTransform=i;ak.oTransform=i;ak.transform=i}U.fn.abigimage=function(s){ah=this;P=U.extend(true,U.fn.abigimage.defaults,s);this.overlay=ao.attr(P.overlayAttrs).css(P.overlayCSS);this.layout=S.attr(P.layoutAttrs).css(P.layoutCSS);this.box=n.attr(P.boxAttrs).css(P.boxCSS);this.prevBtnWrapper=Y.attr(P.prevBtnWrapperAttrs).css(P.prevBtnWrapperCSS);this.prevBtnBox=G.attr(P.prevBtnBoxAttrs).css(P.prevBtnBoxCSS);this.prevBtn=v.attr(P.prevBtnAttrs).css(P.prevBtnCSS).html(P.prevBtnHtml);this.closeBtnWrapper=B.attr(P.closeBtnWrapperAttrs).css(P.closeBtnWrapperCSS);this.closeBtnBox=O.attr(P.closeBtnBoxAttrs).css(P.closeBtnBoxCSS);this.closeBtn=Z.attr(P.closeBtnAttrs).css(P.closeBtnCSS).html(P.closeBtnHtml);this.img=p.attr(P.imgAttrs).css(P.imgCSS);this.imgNext=z.attr(P.imgNextAttrs).css(P.imgNextCSS);this.imgPrev=ag.attr(P.imgPrevAttrs).css(P.imgPrevCSS);this.bottom=b.attr(P.bottomAttrs).css(P.bottomCSS);var k={};for(var t in P.prevBtnHoverCSS){if(P.prevBtnCSS){k[t]=P.prevBtnCSS[t]}}var d={};for(var t in P.closeBtnHoverCSS){if(P.closeBtnCSS){d[t]=P.closeBtnCSS[t]}}var i={};for(var t in P.bottomHoverCSS){if(P.bottomCSS){i[t]=P.bottomCSS[t]}}this.prevBtnWrapper.hover(function(){v.stop().animate(P.prevBtnHoverCSS,P.fadeIn)},function(){v.stop().animate(k,P.fadeOut)});this.closeBtnWrapper.hover(function(){Z.stop().animate(P.closeBtnHoverCSS,P.fadeIn)},function(){Z.stop().animate(d,P.fadeOut)});this.bottom.hover(function(){b.stop().animate(P.bottomHoverCSS,P.fadeIn)},function(){b.stop().animate(i,P.fadeOut)});return this.each(function(x){U(this).unbind("click.abigimage").bind("click.abigimage",function(){return M(x)})})};U.abigimage={open:M,next:f,prev:Q,close:aj,unbind:I};U.fn.abigimage.defaults={fadeIn:"fast",fadeOut:"fast",slideWidth:0.4,slideVelocity:0.4,zoomMin:1.5,zoomMax:5,prevBtnHtml:"&larr;",closeBtnHtml:"x",keyNext:[13,32,39,40],keyPrev:[8,37,38],keyClose:[27,35,36],onopen:function(){},onclose:function(){},overlayCSS:{position:"fixed",zIndex:101,top:0,right:0,bottom:0,left:0,backgroundColor:"#000",opacity:0.9},layoutCSS:{position:"fixed",zIndex:101,top:0,right:0,bottom:0,left:0,"-webkit-user-select":"none","-moz-user-select":"none","user-select":"none","-webkit-tap-highlight-color":"rgba(0, 0, 0, 0)",lineHeight:2.5},boxCSS:{position:"absolute",width:"312.5%",height:"100%",left:"-106.25%",top:0},prevBtnWrapperCSS:{cursor:"pointer",position:"absolute",top:0,right:"50%",bottom:0,left:0},closeBtnWrapperCSS:{cursor:"pointer",position:"absolute",top:0,right:0,bottom:0,left:"50%"},prevBtnBoxCSS:{position:"absolute",zIndex:103,top:0,bottom:0,left:"68%"},closeBtnBoxCSS:{position:"absolute",zIndex:103,top:0,bottom:0,right:"68%"},prevBtnCSS:{color:"#fff",backgroundColor:"#000",opacity:0.5,padding:"0 1em",borderRadius:"0 0 1ex 0"},closeBtnCSS:{color:"#fff",backgroundColor:"#000",opacity:0.5,padding:"0 1em",borderRadius:"0 0 0 1ex"},prevBtnHoverCSS:{opacity:1},closeBtnHoverCSS:{opacity:1},imgCSS:{position:"absolute",zIndex:102,margin:"auto",width:"auto",top:0,right:0,bottom:0,left:0,display:"block",cursor:"pointer",maxWidth:"32%",maxHeight:"100%"},imgNextCSS:{position:"absolute",margin:"auto",width:"auto",top:0,right:0,bottom:0,left:"68%",display:"block",maxWidth:"32%",maxHeight:"100%"},imgPrevCSS:{position:"absolute",margin:"auto",width:"auto",top:0,right:"68%",bottom:0,left:0,display:"block",maxWidth:"32%",maxHeight:"100%"},bottomCSS:{position:"fixed",zIndex:104,right:0,bottom:0,left:0,"-webkit-user-select":"text","-moz-user-select":"text","user-select":"text",backgroundColor:"#000",color:"#fff",opacity:0.5,padding:"0 1em",textAlign:"center"},bottomHoverCSS:{opacity:1},overlayAttrs:{},layoutAttrs:{},boxAttrs:{},prevBtnWrapperAttrs:{},prevBtnBoxAttrs:{},prevBtnAttrs:{},closeBtnWrapperAttrs:{},closeBtnBoxAttrs:{},closeBtnAttrs:{},imgAttrs:{},imgNextAttrs:{},imgPrevAttrs:{},bottomAttrs:{}}}(jQuery));