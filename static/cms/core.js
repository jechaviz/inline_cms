function cmsAddCore(a){a.isCodeEditorLoaded=false;a.hasUnsavedChanges=false;a.formsLoaded={};a.langPhrases={};a.setChanges=function(){this.hasUnsavedChanges=true;$(".btn-save",this.panel).addClass("glow").find("i").removeClass("fa-check").addClass("fa-exclamation-circle")};a.hasChanges=function(){return this.hasUnsavedChanges};a.noChanges=function(){this.hasUnsavedChanges=false;$(".btn-save",this.panel).removeClass("glow").find("i").removeClass("fa-exclamation-circle").addClass("fa-check")};a.loadLang=function(c,b){this.runModule("langs","loadLang",{lang:this.options.lang,set:c},function(d){a.langPhrases=d;if(typeof(b)==="function"){b()}})};a.loadWidgetLang=function(b,c){this.runModule("langs","loadWidgetLang",{lang:this.options.lang,handler:b},function(d){if(typeof(c)==="function"){c(d)}})};a.lang=function(d,c){if(typeof(this.langPhrases[d])==="undefined"){return d}var b=this.langPhrases[d];if(typeof(c)!=="undefined"){for(var e in c){b=b.replace(new RegExp("{"+e+"}","g"),c[e])}}return b};a.getFrameWindow=function(){return window.frames[0]};a.getLanguage=function(){return this.options.lang};a.getDefaultPageLanguage=function(){return this.options.defaultLang};a.runModule=function(b,c,d,e){if(typeof(d)==="undefined"){d={}}d._module=b;d._action=c;$.post(this.options.backendUrl,d,function(f){if(f.success===false&&f.error){a.showMessageDialog(f.error,a.lang("error"));return}if(f.success===false&&f.no_auth){a.showConfirmationDialog(a.lang("reauthConfirm"),function(){location.href="?edit"},function(){location.reload()});return}if(typeof(e)==="function"){e(f)}},"json")};a.getModuleUrl=function(b,d,e){if(typeof(e)==="undefined"){e={}}var c=$.extend({_module:b,_action:d},e);return this.options.backendUrl+"?"+$.param(c)};a.injectScript=function(c,f){var e=this.pageFrame.get(0);var d=e.getElementsByTagName("body")[0];var b=e.createElement("script");b.type="text/javascript";b.src=c;b.onreadystatechange=f;b.onload=f;d.appendChild(b)};a.loadScript=function(b,c){$.getScript(b,c)};a.loadScripts=function(c,d,b){if(typeof(b)==="undefined"||b===false){c.reverse()}if(c.length===1){this.loadScript(c.pop(),d)}else{this.loadScript(c.pop(),function(){a.loadScripts(c,d,true)})}};a.loadStylesheet=function(b,e){var c=document.getElementsByTagName("head")[0];var d=document.createElement("link");d.rel="stylesheet";d.type="text/css";d.href=b;d.onreadystatechange=e;d.onload=e;c.appendChild(d)};a.moveItemInArray=function(e,d,b){if(b>=e.length){var c=b-e.length;while((c--)+1){e.push(undefined)}}e.splice(b,0,e.splice(d,1)[0])};a.buildPanel=function(){this.panel=$("#inlinecms-panel");this.panel.draggable({handle:".title",iframeFix:true,stop:function(){a.savePanelState()}});$(".title .tb-collapse",this.panel).on("click",function(b){b.preventDefault();$(".body",a.panel).slideToggle(250,function(){a.savePanelState()});$("i",this).toggleClass("fa-caret-up").toggleClass("fa-caret-down");return false});$(".title",this.panel).on("dblclick",function(b){$(".tb-collapse",$(this)).click()})};a.showLoadingIndicator=function(){if($(".inlinecms-loading-indicator").length){$(".inlinecms-loading-indicator").show();return}var b=$("<div></div>").addClass("inlinecms-loading-indicator");b.append('<i class="fa fa-spinner fa-pulse"></i>').show();$("body").append(b)};a.hideLoadingIndicator=function(){$(".inlinecms-loading-indicator").hide()};a.showMessageDialog=function(f,g){var b=f;if(typeof(f)==="object"){b=$("<ul></ul>").addClass("messages-list");for(var d in f){var c=$("<li></li>").html(f[d]);b.append(c)}}var e={};e[this.lang("ok")]=function(){$(this).dialog("close")};$('<div class="message-text inlinecms"></div>').append(b).dialog({title:g,modal:true,resizable:false,width:350,buttons:e})};a.showPromptDialog=function(g,h,i,c){var f=$("<div/>").addClass("message-prompt inlinecms");var b=$("<div/>").addClass("prompt").html(g);var d=$("<input/>").attr("type","text").val(c);var e={};e[this.lang("ok")]=function(){i(d.val());$(this).dialog("close")};e[this.lang("cancel")]=function(){$(this).dialog("close")};f.append(b).append(d).dialog({title:h,modal:true,resizable:false,width:350,buttons:e,open:function(){setTimeout(function(){d.focus()},10)}})};a.showConfirmationDialog=function(d,b,e){var c={};c[this.lang("yes")]=function(){if(typeof(b)==="function"){b()}$(this).dialog("close")};c[this.lang("no")]=function(){if(typeof(e)==="function"){e()}$(this).dialog("close")};$('<div class="message-text inlinecms"></div>').append(d).dialog({title:this.lang("confirmation"),modal:true,resizable:false,width:350,buttons:c,open:function(){$(this).closest(".ui-dialog").find(".ui-dialog-buttonset .ui-button:first").addClass("green");$(this).closest(".ui-dialog").find(".ui-dialog-buttonset .ui-button:last").addClass("red")}})};a.openForm=function(b){var c=typeof(this.formsLoaded[b.id])!=="undefined";if(!c||b.cache===false){if(typeof(b.onCreate)!=="function"){b.onCreate=false}this.loadForm(b,function(){a.showForm(b)});return}this.hideLoadingIndicator();this.showForm(b)};a.loadForm=function(c,b){this.showLoadingIndicator();var d={};if(typeof(c.source.data)!=="undefined"){d=c.source.data}this.runModule(c.source.module,c.source.action,d,function(f){a.hideLoadingIndicator();$("#inlinecms-form-"+c.id).remove();var e=$("<div></div>").attr("id","inlinecms-form-"+c.id);e.addClass("inlinecms-options-form").addClass("inlinecms").hide().append(f.html);if(e.find(".tabs").length===1){$(".tabs",e).tabs({activate:function(){if(typeof(c.onTabChange)==="function"){c.onTabChange(e)}}})}if(typeof(c.onCreate)==="function"){c.onCreate(e)}$("body").append(e);a.formsLoaded[c.id]=true;if(typeof(b)==="function"){b()}})};a.showForm=function(c){var f=$("#inlinecms-form-"+c.id);if(typeof(c.onBeforeShow)==="function"){c.onBeforeShow(f)}if(f.find(".tabs").length===1){$(".tabs ul li a",f).eq(0).click()}if(c.values!==false){$("*[name]",f).val("");$("select option:first-child",f).attr("selected","selected");for(var d in c.values){var g=c.values[d];var b=$("*[name="+d+"]",f);if(b.attr("type")!="checkbox"){b.val(g)}else{b.prop("checked",g)}}}var e={};e[c.buttons.ok]=function(){var i=$(this);var j=$("form",$(this).dialog());if(typeof(c.onBeforeSubmit)==="function"){c.onBeforeSubmit(j)}var h={};$(".field *[name]",j).each(function(){var k=$(this);var l;if(k.attr("type")!="checkbox"){l=k.val()}else{l=k.prop("checked")}h[k.attr("name")]=l});if(typeof(c.onValidate)==="function"){c.onValidate(h,function(k){if(k.success===true){a.submitForm(h,j,i,c);return}a.showMessageDialog(k.error,a.lang("error"))})}else{a.submitForm(h,j,i,c)}};e[a.lang("cancel")]=function(){$(this).dialog("close");if(typeof(c.onCancel)==="function"){c.onCancel(f)}};if(typeof(c.onShow)==="function"){c.onShow(f,c.values)}f.dialog({title:c.title,modal:true,buttons:e,width:typeof(c.width)==="undefined"?450:c.width,minWidth:300,position:{my:"center top",at:"center top+50",of:window},open:function(){$(this).closest(".ui-dialog").find(".ui-dialog-buttonset .ui-button:first").addClass("green");if(typeof(c.onAfterShow)==="function"){c.onAfterShow(f)}}})};a.submitForm=function(b,e,d,c){if(typeof(c.onSubmit)==="function"){c.onSubmit(b,e)}d.dialog("close")};a.clearFormCache=function(b){delete this.formsLoaded[b];$("#inlinecms-form-"+b).remove()};a.loadCodeEditor=function(b){if(this.isCodeEditorLoaded){b();return}this.loadStylesheet(this.options.rootUrl+"/static/codemirror/lib/codemirror.css",function(){a.loadScripts([a.options.rootUrl+"/static/codemirror/lib/codemirror.js",a.options.rootUrl+"/static/codemirror/mode/javascript/javascript.js",a.options.rootUrl+"/static/codemirror/mode/css/css.js",a.options.rootUrl+"/static/codemirror/mode/xml/xml.js"],function(){a.isCodeEditorLoaded=true;if(typeof(b)==="function"){b()}})})}};